					<!--begin::Content-->
					<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
						<!--begin::Entry-->
						<div class="d-flex flex-column-fluid">
							
							<!--begin::Container-->
							<div class="container">

								<!-- begin::Card--> 
								<div class="card card-custom overflow-hidden">
									<div class="card-body p-0">
										<!-- begin: Invoice-->
										<!-- begin: Invoice header-->

										<!-- begin acction button-->
										<div class="row justify-content-center bgi-size-cover bgi-no-repeat py-8 px-8 px-md-0"  >
											  <div class="col-md-11 d-flex flex-column align-items-md-end px-0">
															<!--begin::Dropdown-->
											<div class="dropdown dropdown-inline mr-2">
												<button type="button" class="btn btn-light-primary font-weight-bolder dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
												<span class="svg-icon svg-icon-md">
													<!--begin::Svg Icon | path:assets/media/svg/icons/Design/PenAndRuller.svg-->
													<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
														<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
					 										<rect x="0" y="0" width="24" height="24" />
															<path d="M3,16 L5,16 C5.55228475,16 6,15.5522847 6,15 C6,14.4477153 5.55228475,14 5,14 L3,14 L3,12 L5,12 C5.55228475,12 6,11.5522847 6,11 C6,10.4477153 5.55228475,10 5,10 L3,10 L3,8 L5,8 C5.55228475,8 6,7.55228475 6,7 C6,6.44771525 5.55228475,6 5,6 L3,6 L3,4 C3,3.44771525 3.44771525,3 4,3 L10,3 C10.5522847,3 11,3.44771525 11,4 L11,19 C11,19.5522847 10.5522847,20 10,20 L4,20 C3.44771525,20 3,19.5522847 3,19 L3,16 Z" fill="#000000" opacity="0.3" />
															<path d="M16,3 L19,3 C20.1045695,3 21,3.8954305 21,5 L21,15.2485298 C21,15.7329761 20.8241635,16.200956 20.5051534,16.565539 L17.8762883,19.5699562 C17.6944473,19.7777745 17.378566,19.7988332 17.1707477,19.6169922 C17.1540423,19.602375 17.1383289,19.5866616 17.1237117,19.5699562 L14.4948466,16.565539 C14.1758365,16.200956 14,15.7329761 14,15.2485298 L14,5 C14,3.8954305 14.8954305,3 16,3 Z" fill="#000000" />
														</g>
													</svg>
													<!--end::Svg Icon-->
												</span>Action</button>
												<!--begin::Dropdown Menu-->
												<div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
													<!--begin::Navigation-->
													<ul class="navi flex-column navi-hover py-2">
														<li class="navi-header font-weight-bolder text-uppercase font-size-sm text-primary pb-2">Choose an option:</li>
														<li class="navi-item">
															
																<span class="navi-icon">
																	
																</span>
																<!--<button type="button" class="btn btn-hover-bg-success btn-text-success  border-0 font-weight-bold headerapprove" style="width:100%">Accept</button>-->
															
														</li>
														<li class="navi-item">
															
															<span class="navi-icon">
															
															</span>
															<!-- <button type="button" class="btn btn-hover-bg-success btn-text-primary  border-0 font-weight-bold" data-toggle="modal" data-target="#myModaldate" id="modaldate" style="width:100%">Accept & Modify</button>
															<NLFORM>
																<form method="POST" >
																	
															<button type="submit" class="btn btn-hover-bg-danger btn-text-danger  border-0 font-weight-bold"   id="reject" name="save" value="rejected" style="width:100%">Rejected</button>
                                                              </form>
															</NLFORM> -->
															<!-- <button type="button" class="btn btn-hover-bg-success btn-text-primary  border-0 font-weight-bold" style="width:100%"  onclick="window.open('${ds.exportcsv}')">Export All Items</button> -->
															
																<a style="width:100%" href="${ds.exportcsv}" class="navi-link"><span class="navi-icon"></span><span class="navi-text">Export CSV</span>
																</a>
                                                                 <a style="width:100%" href="${ds.exportgooglesheet}" class="navi-link" target="_blank"><span class="navi-icon"></span><span class="navi-text">Open In Google Sheet</span></a>
														


													     </li>
														 <li class="navi-item">
															
															<span class="navi-icon">
															
															</span>
														
													     </li>
														 <li class="navi-item">
															
															<span class="navi-icon">
															
															</span>
														</li>

													
													
													</ul>
													<!--end::Navigation-->
												</div>
												<!--end::Dropdown Menu-->
											</div>

 

												</div>

											<!-- end action-->
											
											<div class="col-md-9">
												
												<div class="d-flex justify-content-between pb-10 pb-md-20 flex-column fl pt-6"> 
													<h1 class="display-4 font-weight-boldest mb-10 opacity-80" >PO Request <br> <span class="label label-lg font-weight-bold label-light-primary label-inline"> <%= status %>  </span></span><span id="updatespinner" class="spinner spinner-primary spinner-lg mr-15" style="display: none;"> </span> <span id="updatestatus" style="display: none;"> <i class="fas fa-check-circle text-success icon-2x" data-toggle="Netsuite" title="Synced With Netsuite"></i> </span>  </h1>  
																			
													
												</div>
												
												<div class="border-bottom w-100"></div>
												<div class="d-flex justify-content-between pt-6">
													<div class="d-flex flex-column flex-root">
														<span class="font-weight-bolder mb-2 ">DATE</span> 
														<span class="opacity-70"><%= date %></span>
													</div>
													<div class="d-flex flex-column flex-root">
														<span class="font-weight-bolder mb-2">PO Request #</span>
														<span class="opacity-70"><%= tranId %></span>
													</div>
													<div class="d-flex flex-column flex-root">
														<span class="font-weight-bolder mb-2">Location.</span>
														<span class="opacity-70"><%= location %></span>
													</div>
												</div>
											</div>
										</div>
										<!-- end: Invoice header-->
										<!-- begin: Invoice body-->
										<div class="row justify-content-center py-8 px-8 py-md-10 px-md-0">
											<div class="col-md-11">
                                                <div id="load_btn_container" class="btn col-md-12 btn-hover-primary bg-primary h-38px btn_loaditems text-white text-center">Item Details<i class="fas fa-caret-right text-white icon-2x" style="float: right;"></i></div>
												<div class="col-md-12" id="table_container" style="box-shadow: 0 0 10px 0 rgba(34, 30, 30, 0.178); display: none; padding-bottom: 10px;" >

													<div class="table-responsive">
														<table class="table" id="table-main">
															<tbody>
															</tbody>
														</table>
													</div>
												</div>
											</div>
										</div>
										<!-- end: Invoice body-->
										<!-- begin: Invoice footer-->
										<div class="row justify-content-center bg-gray-100 py-8 px-8 py-md-10 px-md-0">
											<div class="col-md-11">

	
													    <div class="table-responsive">
															<table class="table" id="formtable">
																<thead>
																	<tr>
																		<th class="font-weight-bold text-muted text-uppercase">Total Requested Qty</th>
																		<th class="font-weight-bold text-muted text-uppercase">Total Requested Amount</th>
																		<th class="font-weight-bold text-muted text-uppercase ">Total Accepted Qty</th>
																		<th class="font-weight-bold text-muted text-uppercase ">Total Accepted Amount</th>
												 					</tr>
																</thead>
																<tbody>
																	<tr class="">
																		<td class=" font-size-h6 " style="text-align: center;" id="totalqty"></td>
																		<td class=" font-size-h6 " style="text-align: center;" id="totalamount">  </td>
																		<td class=" font-size-h6 " style="text-align: center;" id="totalacceptedquantity"></td>
																		<td class=" font-size-h6" style="text-align: center;" id="totalaccetedamount"> </td>
																	</tr>     
																	
																</tbody>
															</table>
													    </div>
											</div>
										</div>
									
										<!-- end: Invoice footer-->
										<!-- begin: Invoice action-->
										<div class="row justify-content-center py-8 px-8 py-md-10 px-md-0">
											<div class="col-md-9">
												<div class="d-flex justify-content-between">

													
													<!-- <button type="submit" class="btn btn-light-success font-weight-bold headerapprove" >Accept</button>-->
                                                      
													<button type="button" class="btn btn-light-primary font-weight-bold" onclick="window.open('${ds.attachfile}', 'test', 'width=600, height=400');">Attach Files</button>
													<button type="button" id="save" class="btn btn-primary font-weight-bold" >save</button>
                                                   <!-- <button type="button" class="btn btn-hover-bg-dark btn-text-dark  border-0 font-weight-bold" onclick="window.open('${ds.attachfile}', 'test', 'width=600, height=400');">Attach Files</button>-->

                                                </div>
											</div>
										</div>
										<!-- end: Invoice action-->
										<!-- end: Invoice-->
									</div>
								</div>
								<!-- end::Card-->
							</div>
							<!--end::Container-->
						</div>
						<!--end::Entry-->
					</div>
					<!--end::Content-->

  <!-- Modal -->
  <div class="modal fade" id="myModaldate" role="dialog">
	<div class="modal-dialog">
	
	  <!-- Modal content-->
	  <div class="modal-content">
		<div class="modal-header">
		<h5 class="modal-title" id="exampleModalLabel">Change Date To all Items</h5>
		
		
		</div>
		<div class="modal-body">
			<NLFORM>
				<form method="POST" action="/purchaseRequestForm">
					<div id="totalcount" style="display:none;">

					</div>
					<label for="changeallitemdate">Expected Delivery Date</label>
					<input type="date" id="changeallitemdate" class="form-control changeallitemdate" name="changeallitemdate" value="">
					<input type="text"  id="pointernalid" name="pointernalid" value="" style="display:none;">
		
			<table class="table modeltable">
				<thead>
					<tr> 
						<th scope="col" style="display:none;">line #</th>
						<th scope="col">Product</th>
						<th scope="col">A.Qty</th>
						<th scope="col">Ordered Qty</th>
						<th scope="col">Rate</th>
						<th scope="col">Remove</th>
					</tr>
				</thead>
				<tbody class="table-body">

				</tbody>
		
			</table>
			<button type="submit" class="btn btn-primary" name="save" value="linedate">Save</button>
		</form>
	</NLFORM>
		</div>

		<div class="modal-footer">
	   
		</div>
	</div>
	  
	</div>
  </div>
   <!-- END  Modal -->
   <NLFORM>
		<form method="POST" id="approveform" >
			<div id="approvepost" style="display: none;">
			</div>
		</form>
	</NLFORM>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.js"></script>



<script>

               var loc=window.location.href
                var url = new URL(loc).href;
                urlSplit=url.split('=')
                console.log("url",urlSplit)

var dataParse ="";
	  $(function () {

		

		 $('.modeltable .table-body').on('click' , '#deltop',function(){

			$(this).parents('tr').remove();
			counttd--
		 })

		$(".headerapprove").click(function () 
		{
			
          var counttd=0
	     //Loop through all checked CheckBoxes in GridView.
	     $("#table-main tbody input[type=checkbox]:checked").each(function () {
		 // var row = $(this).closest("tr")[0];
		 //var name = $('.txt-td').val();
		 linenumber=$(this).parents("tr").find(".linenumber").text();
		  td='<input type="text" id="changeallitemdate" class="form-control changeallitemdate" name="lineapprove'+counttd+'" value="'+linenumber+' " >'
		  $('#approvepost').append(td);
		  counttd++
		 });
		 td='<button type="submit" class="btn btn-light-success font-weight-bold" id="btnapprove" name="save" value="approve">Approve</button>'
		 $('#approvepost').append(td);
		 total= '<input id="linenumbertop" class="form-control" value="'+counttd+'" name="linenumbertop" >' 
	       $('#approvepost').append(total);
		 console.log("check")
		 $("#btnapprove").click();
		 const form  = document.getElementById('#approveform');
         // form.addEventListener('submit', (event) => {
           // handle the form data
		  // form.submit();
            // });
	      
         })


   });

   $("#save").click(function () {

	$('#updatespinner').show();
	$('#updatestatus').hide();
	
   $('.modeltable .table-body').empty();
     var counttd=0
	 var poObject={}
	 var dataArray=[]
     var nodata='<tr colspan="7"><td>No data Selected </td></tr>'

	 $("#table-main tbody input[type=checkbox]:checked").each(function () {
		
	
		linenumber=$(this).parents("tr").find(".linenumber ").text() 
		 item =$(this).parents("tr").find(".item").text();
		 qty =$(this).parents("tr").find(".inputquantity").val();
		 rate =$(this).parents("tr").find(".rate").text();
		 date =$(this).parents("tr").find(".inputdate").val();
		
		dataArray.push({
			item       :  item,
			quantity   :  qty,
			date       :  date,
			lineId     : linenumber-1
		})
 
		console.log("dataArray",dataArray)

	});
	poObject={
		save       :  "lineDate",
		internalId : urlSplit[1],
		data       : dataArray
	}
	$("#load_btn_container").click();

	$.ajax({ 
                type      : 'POST', //Method type
                url       : '/purchaseRequestForm', //Your form processing file URL
                data      : JSON.stringify(poObject), //Forms name
                contentType: "application/json; charset=utf-8",
                success   : function(data) 
                            {
								console.log(data)
								$('#updatestatus').show();
								$('#updatespinner').hide();
								
								$("#load_btn_container").click();
                            }
							
             
            });


})

 

  $('#load_btn_container').click(function () 
        {
          
			function setTimeout(milliseconds){   
            var date = new Date();
            date.setMilliseconds(date.getMilliseconds() + milliseconds);
            while(new Date() < date){
            }
            }

			var  startTime = Date.now()/1000;


           if($('.btn_loaditems').html()=='Item Details<i class="fas fa-c icon-2x" style="float:right;"></i>')
           {
            $('#table_container').css('display','none');
            $('.btn_loaditems').empty();
            $('.btn_loaditems').append('Item Details<i class="fas fa-ca icon-2x" style="float:right;"></i>');
            $('#table-main').empty();
            $('#btn_save').hide();
            $('#btncancel').hide();
            return
           }
           $('.btn_loaditems').empty();
           $('.btn_loaditems').append('Item Details<i class="fas fa-c icon-2x" style="float:right;"></i>');
           $('#table_container').css('display','block');
		   
           $('#table-main').empty();
           $('#table-main').append('<div class="col-md-12"><p text-xl-left></p> <p style="text-align: center">Please wait.. </p><p></p> <div style=" " class=" spinner spinner-primary spinner-lg mr-45  spinner-center"></div>   </div>');
         

         
              
                var tableData='<thead style="text-align: center;">'
                var postForm={};
                var record=""
               
               

               
                postForm = { //Fetch form data
                    
                        };
					
                                var poInternalId = urlSplit[1]

          

           $.ajax({ 
                type      : 'GET', //Method type
                url       : '/purchaseRequestForm/itemdetail&id='+poInternalId, //Your form processing file URL
                data      : JSON.stringify(postForm), //Forms name
                contentType: "application/json; charset=utf-8",
                success   : function(data) 
                            {
                                
								console.log(data)
                                $('#table-main').empty();

                                 dataParse=data
                                
                                var totalQuantity = 0
                                var totalAmount = 0
								var totalAcceptedQuantity = 0
								var totalAcceptedAmount   =  0

								
								tableData+= '<tr>'
											 +'<th data-field="RecordID" id="table-checkAll" class="datatable-cell-center datatable-cell datatable-cell-check">'
												+'<span style="width: 20px;"><label class="checkbox checkbox-single checkbox-all">'
													+'<input type="checkbox"  id="checkboxAll">&nbsp;<span></span></label></span></th>'
													+'<th class="text-right pl-0 font-weight-bold text-muted text-uppercase">S#</th>'
													+'<th class="text-center pl-0 font-weight-bold text-muted text-uppercase">Product</th>'
													+'<th class="text-center font-weight-bold text-muted text-uppercase">Requested Quantity</th>'
													+' <th class="font-weight-bold text-muted text-uppercase">Accepted Quantity</th>'
													+'<th class="font-weight-bold text-muted text-uppercase">Delivered Quantity</th>'
													+'<th class="font-weight-bold text-muted text-uppercase">Billed Quantity</th>'
													+'<th class="font-weight-bold text-muted text-uppercase">Rate</th>'
													+'<th class="pr-0 font-weight-bold text-muted text-uppercase">Amount</th>'
													+'<th class="pr-0 font-weight-bold text-muted text-uppercase">Delivery Date</th>'
													+'<th class="text-right pr-0 font-weight-bold text-muted text-uppercase">Accepted</th>'
													+'</tr>'
												+'</thead>'
												+'<tbody>'

					var endTime = Date.now()/1000;
					console.log("end",endTime);
				
					duration = endTime-startTime;
					console.log("duration",duration);


					if(duration>5){
						$('#table-main').append('<div class="col-md-12"><p text-xl-left></p> <p style="text-align: center">Request Timeout... &#128532; Please Load again!  </p><p></p>  </div>');
					}

					else{
						
                                            for(var i=0; i<data.length; i++)
											{
												var date = data[i].values["GROUP(expectedreceiptdate)"]

												if(!date){
													date='';
												}
												else {
													date=moment(date).format("YYYY-MM-DD");
											}


												tableData+='<tr>'
												 tableData+='<td data-field="RecordID" class="datatable-cell-center datatable-cell datatable-cell-check"><span style="width: 20px;"><label class="checkbox checkbox-single"><input type="checkbox" id="checkbox-solo">&nbsp;<span></span></label></span></td>'
												 tableData+='<td class="pl-0  linenumber" name='+parseInt(i+1)+'>'+parseInt(i+1)+'</td>'
                                                 tableData+='<td class="pl-0  txt-td item" name=item'+i+'>'+data[i].values["GROUP(item)"][0].text+'</td>'
                                                 tableData+='<td class="text-center  qty">'+data[i].values["SUM(quantity)"]+'</td>' 
                                                 tableData+='<td class="text-center  accqty"  name=qty'+i+'>'+data[i].values["SUM(custcol_pointstarvendor_originalqty)"]+'</td>'
												 tableData+='<td class="text-center  recty">'+data[i].values["SUM(quantityshiprecv)"]+'</td>'
												 tableData+='<td class="text-center  accqty">'+data[i].values["SUM(quantitybilled)"]+'</td>'
												 tableData+='<td class="text-center  rate">'+data[i].values["MAX(rate)"]+'</td>'
												 tableData+='<td class="text-center  accqty">'+data[i].values["MAX(formulanumeric)"]+'</td>'
												 tableData+='<td class="text-center  date" name=date'+i+'>'+date+'</td>' 
												 tableData+='<td class="text-center  accqty">'+data[i].values["GROUP(formulatext)"]+'</td>'
												 tableData+='</tr>'


												 totalQuantity+=parseInt(data[i].values["SUM(quantity)"])
												 totalAmount+=Number(data[i].values["SUM(quantity)"]*data[i].values["MAX(rate)"])
												 totalAcceptedQuantity+=parseInt(data[i].values["SUM(custcol_pointstarvendor_originalqty)"])
												 totalAcceptedAmount+= Number(data[i].values["MAX(rate)"] * data[i].values["SUM(custcol_pointstarvendor_originalqty)"] )

											}
												 

											tableData+='</tbody>'	

											$('#table-main').append(tableData)

                                    $('#totalqty').text(totalQuantity)
                                    $('#totalamount').text(totalAmount)
									$('#totalacceptedquantity').text(totalAcceptedQuantity)
									$('#totalaccetedamount').text(totalAcceptedAmount)
									$('#pointernalid').val(poInternalId)
									


                                    //     Swal.fire({  icon: 'success',  title: 'Saved', button: "Aww yiss!" ,text: 'Data Saved',  footer: '<a href="/sales-orders">View all saleorder</a>'})
                                    //     $("#trandate option[value='']").attr('selected', true)
                                    //     $("#customer option[value='']").attr('selected', true)
                                    //     $('#btn_save').removeClass('fa fa-spinner fa-spin');
                                    //     $(this).addClass('flaticon2-send-1');
                                    //   ///  window.location.reload();
                                    // event.preventDefault();

                                    // if(recordType!='invoice'){
                                    //     $('#btn_save').show();
                                    // }

                                    $('#btn_save').show();

									
					}
                                    // if(pageType=='view'){
                                    //     $('#btn_save').hide();
                                    // }
									$.fn.checkFunction();
                            }
							
             
            });
           

          //fas fa-caret-down

	
               
            
        });

		
		$(document).ready(function(){

		document.getElementById('load_btn_container').click();



			$('#updatestatus').hide();
			$('#updatespinner').hide();

		 $.fn.checkFunction=function(){
			console.log("checkeddddd");

			// $(".table #checkboxAll").change(function(event){
			// 	console.log("dadadad")
			// if (this.checked){
			// 	alert("Check lag geya jee");
			// 	} else {
			// 	alert("Check laga hi nhi yr");
			// }
			// });

				$(".table #checkbox-solo").change(function(event){
					console.log("dadadad")
					var acceptedQuantity = $(this).parents('tr').find('td:eq(4)').text();
					var requestedQuantity = $(this).parents('tr').find('td:eq(3)').text();

					console.log(acceptedQuantity)
					console.log(requestedQuantity)

					var date = $(this).parents('tr').find('td:eq(9)').text();

			if (this.checked){

				$(this).parents('tr').find('td:eq(4)').html('<input class="inputquantity form-control"  name="quantity" type="number" value='+acceptedQuantity+' min="0" max='+requestedQuantity+'>');
				$(this).parents('tr').find('td:eq(9)').html('<input class="inputdate form-control" type="date" name="date" value='+moment(date).format("YYYY-MM-DD")+' >')

			} else {

				var quantity22 = $(this).parents('tr').find('input[name="quantity"]').val();
				var date22 = $(this).parents('tr').find('input[name="date"]').val();

				$(this).parents('tr').find('td:eq(4)').text(quantity22);
				$(this).parents('tr').find('td:eq(9)').text(date22);

				$(this).parents('tr').val(quantity22);
				$(this).parents('tr').val(date22);
				
			}
});

		
		}

		


	});

;
   
	</script>					